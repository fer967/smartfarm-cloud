{% extends "base.html" %}

{% block content %}

<h2>â±ï¸ TelemetrÃ­a en tiempo real</h2>

<div id="card">
    <p>ğŸŒ¡ï¸ Temperatura: <span id="temp">--</span> Â°C</p>
    <p>ğŸ’§ Humedad: <span id="hum">--</span> %</p>
    <p>ğŸ“ Nivel agua: <span id="dist">--</span> cm</p>
    <p>ğŸ“Ÿ Dispositivo: <span id="dev">--</span></p>
    <p>ğŸ•’ Ãšltima lectura: <span id="time">--</span></p>

    <hr>

    <p id="water-alert" class="ok">
        ğŸŸ¢ Nivel de agua OK
    </p>
</div>

<script>
async function loadTelemetry() {
    try {
        const res = await fetch("/telemetry/latest");
        const data = await res.json();
        document.getElementById("temp").innerText = data.temperature ?? "--";
        document.getElementById("hum").innerText = data.humidity ?? "--";
        document.getElementById("dist").innerText = data.water_distance ?? "--";
        document.getElementById("dev").innerText = data.device_id ?? "--";
        document.getElementById("time").innerText = data.timestamp ?? "--";
        const alertEl = document.getElementById("water-alert");
        if (data.water_low === true) {
            alertEl.innerText = "ğŸ”´ ALERTA: Nivel de agua bajo";
            alertEl.className = "alert";
        } else {
            alertEl.innerText = "ğŸŸ¢ Nivel de agua OK";
            alertEl.className = "ok";
        }
    } catch (err) {
        console.error("Error loading telemetry", err);
    }
}

setInterval(loadTelemetry, 3000);
loadTelemetry();
</script>

{% endblock %}






